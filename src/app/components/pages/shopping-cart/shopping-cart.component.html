<div class="shopping-cart-container">

  <p-dialog
    header="Please input your phone number"
    [(visible)]="dialogVisible"
    [modal]="true"
    [style]="{ width: '55vw', height: '45vh' }"
    [draggable]="false"
    [resizable]="false">
    <form class="phone-form__form" [formGroup]="phoneForm" (ngSubmit)="onPhoneFormSubmit()">
      <label for="phoneNumber">Номер телефона</label>
      <ngx-intl-tel-input
        class="ngx-intl-tel-input"
        id="phoneNumber"
        [cssClass]="'custom'"
        [preferredCountries]="['by', 'ru']"
        [enableAutoCountrySelect]="true"
        [enablePlaceholder]="true"
        [searchCountryFlag]="true"
        [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name, SearchCountryField.DialCode]"
        [selectFirstCountry]="true"
        [selectedCountryISO]="CountryISO.Belarus"
        [maxLength]="15"
        [phoneValidation]="true"
        name="phone"
        formControlName="phoneNumber"
      ></ngx-intl-tel-input>
      <small id="phone-help" class="p-error" *ngIf="phoneNumber!.invalid && phoneNumber!.touched">Неверный формат номера</small>
      <div class="p-field login-form__form__code" *ngIf="codeSent">
        <label for="code">Код подтверждения</label>
        <input class="login-form__form__code__input" id="code" type="text" pInputText formControlName="code">
        <small class="p-error" *ngIf="code!.invalid && code!.touched">Неверный код</small>
      </div>
      <button class="submit-button" type="submit" pButton label="Подтвердить" [disabled]="!codeSent && phoneNumber!.invalid || codeSent && code!.invalid"></button>
    </form>
  </p-dialog>

  <p-toast></p-toast>
  <app-header-cart></app-header-cart>
<!--  product list -->
  <div class="cart" *ngIf="productsInCart.length>0; else emptyCart">
    <app-cart-item class="cart-item"
                   *ngFor="let item of productsInCart"
                   [item]="item"
                   (countChange)="onCountChange(item, $event)"
                   (deleteItem)="deleteCartItem($event)"
                   (selectChange)="onSelectChange(item, $event)"
    ></app-cart-item>
    <div class="cart-cost-container">
  <!--  promo Code -->
      <div class="p-inputgroup">

        <input type="text" [(ngModel)]="enteredPromoCode" pInputText placeholder="Promo Сode" />
        <button type="button" pButton label="Apply" styleClass="p-button-warn" (click)="checkPromoCode()"></button>
      </div>
  <!--  Cost + shipping -->
      <div class="cart-cost-info">
        <div class="cart-cost-info__total">
          <p>Sab  total:</p>
          <p>{{totalPrice | currency}}</p>
        </div>
        <div class="cart-cost-info__shipping">
          <p>Shipping: </p>
          <p>{{shippingCost | currency}}</p>
        </div>
        <p-divider></p-divider>
      </div>
    </div>
<!--  Price panel-->

    <app-price-panel class="price-panel" [productPrice]="totalPrice+shippingCost">
      <p total class="price-panel__title">Total: ({{ selectedItem }} items)</p>
      <p-button
        class="price-panel__button"
        label="Proceed to checkout"
        styleClass="p-button-text p-button-lg"
        (click)="confirmOrder()"
      ></p-button>
    </app-price-panel>
  </div>
<!--  IF Cart is empty -->
  <ng-template #emptyCart >
    <h1 class="empty-cart">Yor cart is empty, please visit our <a routerLink="/shop"> shop</a>!</h1>
  </ng-template>
</div>
